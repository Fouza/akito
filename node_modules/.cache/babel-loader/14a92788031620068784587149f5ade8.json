{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\THINKPAD L480\\\\Desktop\\\\Work\\\\akito\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\THINKPAD L480\\\\Desktop\\\\Work\\\\akito\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"C:\\\\Users\\\\THINKPAD L480\\\\Desktop\\\\Work\\\\akito\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:\\\\Users\\\\THINKPAD L480\\\\Desktop\\\\Work\\\\akito\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import{IonCard,IonCardHeader,IonCardContent,IonContent,IonGrid,IonRow,IonCol,IonItem,IonInput,IonList,IonButton,IonText,IonAlert,IonLabel,isPlatform}from\"@ionic/react\";import{useForm}from\"react-hook-form\";import\"./login-register.css\";import axios from\"axios\";var Login=function Login(){var _useState=useState(),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),username=_useState4[0],setUsername=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),usernameReg=_useState6[0],setUsernameReg=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),pwd=_useState8[0],setPwd=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),pwdReg=_useState10[0],setPwdReg=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),change=_useState12[0],setChange=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),alert=_useState14[0],setAlert=_useState14[1];var _useState15=useState(\"Inscription avec succès\"),_useState16=_slicedToArray(_useState15,2),message=_useState16[0],setMessage=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isError=_useState18[0],setIsError=_useState18[1];var _useState19=useState(\"\"),_useState20=_slicedToArray(_useState19,2),errorMessage=_useState20[0],setErrorMessage=_useState20[1];//const history = createHashHistory();\n// validation forms\nvar initialValues={pseudo:\"\",email:\"\"};var _useForm=useForm({defaultValues:_objectSpread({},initialValues),mode:\"onChange\"}),control=_useForm.control,handleSubmit=_useForm.handleSubmit,formState=_useForm.formState,reset=_useForm.reset,errors=_useForm.errors;var showError=function showError(_fieldName){var error=errors[_fieldName];return error?/*#__PURE__*/React.createElement(\"div\",{style:{color:\"red\",fontWeight:\"bold\"}},error.message||\"Field Is Required\"):null;};function cnx(){setChange(false);}function inscr(){setChange(true);}function hasProfile(_x,_x2){return _hasProfile.apply(this,arguments);}function _hasProfile(){_hasProfile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id,token){var config;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:config={headers:{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Access-Control-Allow-Headers\":\"*\",Authorization:\"Bearer \".concat(localStorage.getItem(\"token\"))}};_context.next=3;return axios.get(\"http://c51e59d288f7.ngrok.io/api/service/user/hasProfile/\".concat(id),config).then(function(res){if(res.data){localStorage.setItem(\"fitnessExist\",\"true\");window.location.replace(\"/page/Accueil\");}else{localStorage.setItem(\"fitnessExist\",\"false\");if(!isPlatform(\"desktop\")){window.location.replace(\"/stepper\");}else{window.location.replace(\"page/Profile\");}}}).catch(function(err){return console.log(err);});case 3:case\"end\":return _context.stop();}}},_callee);}));return _hasProfile.apply(this,arguments);}function connectRequest(){return _connectRequest.apply(this,arguments);}function _connectRequest(){_connectRequest=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.post(\"http://c51e59d288f7.ngrok.io/api/auth/signin\",{username:username,password:pwd},{headers:{\"Access-Control-Allow-Origin\":\"*\",\"Access-Control-Allow-Headers\":\"*\"}}).then(function(res){if(res.data.id){localStorage.setItem(\"token\",res.data.accessToken);localStorage.setItem(\"roles\",JSON.stringify(res.data.roles));localStorage.setItem(\"id\",res.data.id);localStorage.setItem(\"connected\",\"true\");localStorage.setItem(\"username\",res.data.username);localStorage.setItem(\"email\",res.data.email);hasProfile(res.data.id,res.data.accessToken);}}).catch(function(err){// console.log(err.response.data.message);\n// setMessage(err.response.data.message);\n// setAlert(true);\nif(err.response.status===401){setErrorMessage(\"Identifiant ou mot de passe erroné\");}else if(err.response.status===500){setErrorMessage(\"Connexion impossible\");}setIsError(true);});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return _connectRequest.apply(this,arguments);}function registerRequest(){return _registerRequest.apply(this,arguments);}function _registerRequest(){_registerRequest=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.post(\"http://c51e59d288f7.ngrok.io/api/auth/signup\",{username:usernameReg,password:pwdReg,email:email,role:[\"ROLE_USER\"]},{headers:{\"Access-Control-Allow-Origin\":\"*\",\"Access-Control-Allow-Headers\":\"Origin, Content-Type, Accept\",\"Content-type\":\"application/json\"}}).then(function(res){//setChange(false);\nsetMessage(\"Inscription avec succès\");setAlert(true);//window.location.reload();\n}).catch(function(err){// console.log(err.response.data);\n// //setMessage(err.response.data.errors[0].defaultMessage);\n// setAlert(true);\nif(err.response.status===500){setMessage(\"Veuillez remplir les champs correctement\");}else{setMessage(\"Impossible de s'inscrire\");}setAlert(true);});case 2:case\"end\":return _context3.stop();}}},_callee3);}));return _registerRequest.apply(this,arguments);}function connect(){connectRequest();}function register(){registerRequest();}if(change){return/*#__PURE__*/React.createElement(IonContent,{class:\"content\"},/*#__PURE__*/React.createElement(IonAlert,{isOpen:alert,onDidDismiss:function onDidDismiss(){return setAlert(false);},header:\"Alert\"//ubHeader={\"Inscription avec succès\"}\n,message:message,buttons:[\"OK\"]}),/*#__PURE__*/React.createElement(IonAlert,{isOpen:alert,onDidDismiss:function onDidDismiss(){return setAlert(false);},header:\"Alert\"//ubHeader={\"Inscription avec succès\"}\n,message:message,buttons:[\"OK\"]}),/*#__PURE__*/React.createElement(IonGrid,{class:\"form\"},/*#__PURE__*/React.createElement(IonRow,{class:\"ion-justify-content-center ion-align-items-center form\"},/*#__PURE__*/React.createElement(IonCol,{sizeXs:\"10\",sizeSm:\"10\",sizeMd:\"6\",sizeLg:\"6\",class:\"login-col\"},/*#__PURE__*/React.createElement(IonCard,null,/*#__PURE__*/React.createElement(IonCardHeader,null,/*#__PURE__*/React.createElement(IonText,{class:\"textHeader \"},/*#__PURE__*/React.createElement(\"strong\",null,\"Cr\\xE9er un nouveau compte\"))),/*#__PURE__*/React.createElement(IonCardContent,null,/*#__PURE__*/React.createElement(IonList,null,/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,null,\" Pseudo\"),/*#__PURE__*/React.createElement(IonInput,{name:\"pseudo\",placeholder:\"Pseudo\",onIonChange:function onIonChange(e){return setUsernameReg(e.detail.value);}})),/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonInput,{type:\"email\",name:\"email\",placeholder:\"E-mail\",onIonChange:function onIonChange(e){return setEmail(e.detail.value);}})),/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonInput,{type:\"password\",placeholder:\"Mot de passe\",onIonChange:function onIonChange(e){return setPwdReg(e.detail.value);}})),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(IonRow,{class:\"ion-justify-content-center\"},/*#__PURE__*/React.createElement(IonButton,{class:\"btn-inscrip\",expand:\"block\",color:\"success\",onClick:function onClick(){return register();}},\"Inscrivez-vous\")),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(IonRow,{class:\"ion-justify-content-center\"},/*#__PURE__*/React.createElement(\"a\",{href:\"/login\"},\"Vous avez d\\xE9ja un compte ?\")))))))));}else{return/*#__PURE__*/React.createElement(IonContent,{class:\"content\"},/*#__PURE__*/React.createElement(IonAlert,{isOpen:isError,onDidDismiss:function onDidDismiss(){return setIsError(false);},message:errorMessage}),/*#__PURE__*/React.createElement(IonAlert,{isOpen:alert,onDidDismiss:function onDidDismiss(){return setAlert(false);},header:\"Alert\"//ubHeader={\"Inscription avec succès\"}\n,message:message,buttons:[\"OK\"]}),/*#__PURE__*/React.createElement(IonGrid,{class:\"form\"},/*#__PURE__*/React.createElement(IonRow,{class:\"ion-justify-content-center ion-align-items-center form\"},/*#__PURE__*/React.createElement(IonCol,{sizeXs:\"10\",sizeSm:\"10\",sizeMd:\"6\",sizeLg:\"6\",class:\"login-col\"},/*#__PURE__*/React.createElement(IonCard,null,/*#__PURE__*/React.createElement(IonCardHeader,null,/*#__PURE__*/React.createElement(IonText,{class:\"textHeader \"},/*#__PURE__*/React.createElement(\"strong\",null,\"Connectez-vous pour un mode de vie sain. En toute simplicit\\xE9.\"))),/*#__PURE__*/React.createElement(IonCardContent,null,/*#__PURE__*/React.createElement(IonList,null,/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonInput,{placeholder:\"pseudo\"// formControlName=\"Pseudo\"\n,required:true,onIonChange:function onIonChange(e){return setUsername(e.detail.value);}})),/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonInput,{type:\"password\",placeholder:\"Mot de passe\",onIonChange:function onIonChange(e){return setPwd(e.detail.value);}})),/*#__PURE__*/React.createElement(IonRow,{class:\"ion-justify-content-center\"},/*#__PURE__*/React.createElement(IonCol,{class:\"text-center\",sizeMd:\"12\",sizeXs:\"12\"},/*#__PURE__*/React.createElement(IonButton,{class:\"btn-connec\",expand:\"block\",color:\"success\",onClick:function onClick(){return connect();}},\"Connectez-vous\")),/*#__PURE__*/React.createElement(IonCol,{class:\"text-center\",sizeMd:\"12\",sizeXs:\"12\"},/*#__PURE__*/React.createElement(IonButton,{class:\"btn-inscrip\",expand:\"block\",color:\"primary\",fill:\"clear\",onClick:function onClick(){return inscr();}},\"Inscription\"))),/*#__PURE__*/React.createElement(IonRow,{class:\"ion-justify-content-center\"},\" \",/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"a\",{href:\"#\"},\"Mot de passe oubli\\xE9 ?\"),\" \",/*#__PURE__*/React.createElement(\"br\",null)),/*#__PURE__*/React.createElement(IonRow,{class:\"ion-justify-content-center\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#\"},\"Contactez-nous ?\"),\" \",/*#__PURE__*/React.createElement(\"br\",null)))))))));}};export default Login;","map":{"version":3,"sources":["C:/Users/THINKPAD L480/Desktop/Work/akito/src/components/Login.tsx"],"names":["React","useState","IonCard","IonCardHeader","IonCardContent","IonContent","IonGrid","IonRow","IonCol","IonItem","IonInput","IonList","IonButton","IonText","IonAlert","IonLabel","isPlatform","useForm","axios","Login","email","setEmail","username","setUsername","usernameReg","setUsernameReg","pwd","setPwd","pwdReg","setPwdReg","change","setChange","alert","setAlert","message","setMessage","isError","setIsError","errorMessage","setErrorMessage","initialValues","pseudo","defaultValues","mode","control","handleSubmit","formState","reset","errors","showError","_fieldName","error","color","fontWeight","cnx","inscr","hasProfile","id","token","config","headers","Authorization","localStorage","getItem","get","then","res","data","setItem","window","location","replace","catch","err","console","log","connectRequest","post","password","accessToken","JSON","stringify","roles","response","status","registerRequest","role","connect","register","e","detail","value"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\r\nimport {\r\n  IonCard,\r\n  IonCardHeader,\r\n  IonCardContent,\r\n  IonHeader,\r\n  IonContent,\r\n  IonPage,\r\n  IonGrid,\r\n  IonRow,\r\n  IonCol,\r\n  IonItem,\r\n  IonItemDivider,\r\n  IonInput,\r\n  IonList,\r\n  IonButton,\r\n  IonRouterOutlet,\r\n  IonApp,\r\n  IonImg,\r\n  IonNav,\r\n  IonText,\r\n  IonAlert,\r\n  IonLabel,\r\n  isPlatform,\r\n} from \"@ionic/react\";\r\nimport { IonReactRouter } from \"@ionic/react-router\";\r\nimport { Route, Redirect } from \"react-router-dom\";\r\nimport Register from \"./Register\";\r\n\r\nimport { useForm, Controller } from \"react-hook-form\";\r\nimport \"./login-register.css\";\r\nimport axios from \"axios\";\r\nimport { register } from \"../serviceWorker\";\r\nimport { connect } from \"http2\";\r\nimport { createHashHistory } from \"history\";\r\nimport { withRouter } from \"react-router-dom\";\r\n\r\nconst Login: React.FC = () => {\r\n  const [email, setEmail] = useState<String>();\r\n  const [username, setUsername] = useState<String>();\r\n  const [usernameReg, setUsernameReg] = useState<String>();\r\n  const [pwd, setPwd] = useState<String>();\r\n  const [pwdReg, setPwdReg] = useState<String>();\r\n  const [change, setChange] = useState(false);\r\n  const [alert, setAlert] = useState(false);\r\n  const [message, setMessage] = useState(\"Inscription avec succès\");\r\n\r\n  const [isError, setIsError] = useState(false);\r\n  const [errorMessage, setErrorMessage] = useState(\"\");\r\n\r\n  //const history = createHashHistory();\r\n  // validation forms\r\n  let initialValues = {\r\n    pseudo: \"\",\r\n    email: \"\",\r\n  };\r\n\r\n  const { control, handleSubmit, formState, reset, errors } = useForm({\r\n    defaultValues: { ...initialValues },\r\n    mode: \"onChange\",\r\n  });\r\n\r\n  const showError = (_fieldName: string) => {\r\n    let error = (errors as any)[_fieldName];\r\n    return error ? (\r\n      <div style={{ color: \"red\", fontWeight: \"bold\" }}>\r\n        {error.message || \"Field Is Required\"}\r\n      </div>\r\n    ) : null;\r\n  };\r\n\r\n  function cnx() {\r\n    setChange(false);\r\n  }\r\n  function inscr() {\r\n    setChange(true);\r\n  }\r\n\r\n  async function hasProfile(id: BigInteger, token: String) {\r\n    let config = {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Headers\": \"*\",\r\n        Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\r\n      },\r\n    };\r\n    await axios\r\n      .get(\r\n        `http://c51e59d288f7.ngrok.io/api/service/user/hasProfile/${id}`,\r\n        config\r\n      )\r\n      .then((res) => {\r\n        if (res.data) {\r\n          localStorage.setItem(\"fitnessExist\", \"true\");\r\n          window.location.replace(\"/page/Accueil\");\r\n        } else {\r\n          localStorage.setItem(\"fitnessExist\", \"false\");\r\n          if (!isPlatform(\"desktop\")) {\r\n            window.location.replace(\"/stepper\");\r\n          } else {\r\n            window.location.replace(\"page/Profile\");\r\n          }\r\n        }\r\n      })\r\n      .catch((err) => console.log(err));\r\n  }\r\n\r\n  async function connectRequest() {\r\n    await axios\r\n      .post(\r\n        \"http://c51e59d288f7.ngrok.io/api/auth/signin\",\r\n        {\r\n          username: username,\r\n          password: pwd,\r\n        },\r\n        {\r\n          headers: {\r\n            \"Access-Control-Allow-Origin\": \"*\",\r\n            \"Access-Control-Allow-Headers\": \"*\",\r\n          },\r\n        }\r\n      )\r\n      .then((res) => {\r\n        if (res.data.id) {\r\n          localStorage.setItem(\"token\", res.data.accessToken);\r\n          localStorage.setItem(\"roles\", JSON.stringify(res.data.roles));\r\n          localStorage.setItem(\"id\", res.data.id);\r\n          localStorage.setItem(\"connected\", \"true\");\r\n          localStorage.setItem(\"username\", res.data.username);\r\n          localStorage.setItem(\"email\", res.data.email);\r\n          hasProfile(res.data.id, res.data.accessToken);\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        // console.log(err.response.data.message);\r\n        // setMessage(err.response.data.message);\r\n        // setAlert(true);\r\n        if (err.response.status === 401) {\r\n          setErrorMessage(\"Identifiant ou mot de passe erroné\");\r\n        } else if (err.response.status === 500) {\r\n          setErrorMessage(\"Connexion impossible\");\r\n        }\r\n        setIsError(true);\r\n      });\r\n  }\r\n\r\n  async function registerRequest() {\r\n    await axios\r\n      .post(\r\n        \"http://c51e59d288f7.ngrok.io/api/auth/signup\",\r\n        {\r\n          username: usernameReg,\r\n          password: pwdReg,\r\n          email: email,\r\n          role: [\"ROLE_USER\"],\r\n        },\r\n        {\r\n          headers: {\r\n            \"Access-Control-Allow-Origin\": \"*\",\r\n            \"Access-Control-Allow-Headers\": \"Origin, Content-Type, Accept\",\r\n            \"Content-type\": \"application/json\",\r\n          },\r\n        }\r\n      )\r\n      .then((res) => {\r\n        //setChange(false);\r\n        setMessage(\"Inscription avec succès\");\r\n        setAlert(true);\r\n        //window.location.reload();\r\n      })\r\n      .catch((err) => {\r\n        // console.log(err.response.data);\r\n        // //setMessage(err.response.data.errors[0].defaultMessage);\r\n        // setAlert(true);\r\n        if (err.response.status === 500) {\r\n          setMessage(\"Veuillez remplir les champs correctement\");\r\n        } else {\r\n          setMessage(\"Impossible de s'inscrire\");\r\n        }\r\n        setAlert(true);\r\n      });\r\n  }\r\n\r\n  function connect() {\r\n    connectRequest();\r\n  }\r\n\r\n  function register() {\r\n    registerRequest();\r\n  }\r\n\r\n  if (change) {\r\n    return (\r\n      <IonContent class=\"content\">\r\n        <IonAlert\r\n          isOpen={alert}\r\n          onDidDismiss={() => setAlert(false)}\r\n          header={\"Alert\"}\r\n          //ubHeader={\"Inscription avec succès\"}\r\n          message={message}\r\n          buttons={[\"OK\"]}\r\n        />\r\n        <IonAlert\r\n          isOpen={alert}\r\n          onDidDismiss={() => setAlert(false)}\r\n          header={\"Alert\"}\r\n          //ubHeader={\"Inscription avec succès\"}\r\n          message={message}\r\n          buttons={[\"OK\"]}\r\n        />\r\n        <IonGrid class=\"form\">\r\n          <IonRow class=\"ion-justify-content-center ion-align-items-center form\">\r\n            <IonCol\r\n              sizeXs=\"10\"\r\n              sizeSm=\"10\"\r\n              sizeMd=\"6\"\r\n              sizeLg=\"6\"\r\n              class=\"login-col\"\r\n            >\r\n              <IonCard>\r\n                <IonCardHeader>\r\n                  <IonText class=\"textHeader \">\r\n                    <strong>Créer un nouveau compte</strong>\r\n                  </IonText>\r\n                </IonCardHeader>\r\n                <IonCardContent>\r\n                  <IonList>\r\n                    <IonItem>\r\n                      <IonLabel> Pseudo</IonLabel>\r\n                      <IonInput\r\n                        name=\"pseudo\"\r\n                        placeholder=\"Pseudo\"\r\n                        onIonChange={(e) => setUsernameReg(e.detail.value!)}\r\n                      ></IonInput>\r\n                      {/* <Controller\r\n                              as={IonInput}\r\n                              control={control}\r\n                              onChangeName=\"onIonChange\"\r\n                              onChange={([selected]) => {\r\n                                console.log(\"fullName\", selected.detail.value);\r\n                                return selected.detail.value;\r\n                              }}\r\n                              name=\"pseudo\"\r\n                              rules={{\r\n                                required: true,\r\n                                minLength: { value: 4, message: \"Must be 4 chars long\" }\r\n                              }}\r\n                            /> \r\n                      \r\n                    </IonItem> */}\r\n                      {/* <IonItem>\r\n                      <Controller\r\n                        as={<IonInput />}\r\n                        name=\"pseudo\"\r\n                        control={control}\r\n                        rules={{ required: true ,  minLength: { value: 4, message: \"Must be 4 chars long\" }}}\r\n                        onChangeName=\"onIonChange\"\r\n                        onChange={([e]: any) => {\r\n                          return e.detail.value;\r\n                        }}\r\n                      />*/}\r\n                    </IonItem>\r\n                    <IonItem>\r\n                      <IonInput\r\n                        type=\"email\"\r\n                        name=\"email\"\r\n                        placeholder=\"E-mail\"\r\n                        onIonChange={(e) => setEmail(e.detail.value!)}\r\n                      ></IonInput>\r\n                    </IonItem>\r\n                    <IonItem>\r\n                      <IonInput\r\n                        type=\"password\"\r\n                        placeholder=\"Mot de passe\"\r\n                        onIonChange={(e) => setPwdReg(e.detail.value!)}\r\n                      ></IonInput>\r\n                    </IonItem>\r\n                    <br />\r\n                    <IonRow class=\"ion-justify-content-center\">\r\n                      <IonButton\r\n                        class=\"btn-inscrip\"\r\n                        expand=\"block\"\r\n                        color=\"success\"\r\n                        onClick={() => register()}\r\n                      >\r\n                        Inscrivez-vous\r\n                      </IonButton>\r\n                    </IonRow>\r\n                    {/* <IonRow>\r\n                      <IonCol>\r\n                        <IonButton\r\n                          class=\"btn-connec\"\r\n                           \r\n                          expand=\"block\"\r\n                          fill=\"clear\"\r\n                          onClick={() => connect()}\r\n                        >\r\n                          Connexion\r\n                        </IonButton>\r\n                      </IonCol>\r\n                      <IonCol>\r\n                        <IonButton\r\n                          class=\"btn-connec\"\r\n                          \r\n                          expand=\"block\"\r\n                          fill=\"clear\"\r\n                          onClick={() => inscr()}\r\n                        >\r\n                          Inscription\r\n                        </IonButton>\r\n                      </IonCol>\r\n                    </IonRow> */}\r\n                    <br></br>\r\n                    <IonRow class=\"ion-justify-content-center\">\r\n                      <a href=\"/login\">Vous avez déja un compte ?</a>\r\n                    </IonRow>\r\n                  </IonList>\r\n                </IonCardContent>\r\n              </IonCard>\r\n            </IonCol>\r\n          </IonRow>\r\n        </IonGrid>\r\n      </IonContent>\r\n    );\r\n  } else {\r\n    return (\r\n      <IonContent class=\"content\">\r\n        <IonAlert\r\n          isOpen={isError}\r\n          onDidDismiss={() => setIsError(false)}\r\n          message={errorMessage}\r\n        ></IonAlert>\r\n        <IonAlert\r\n          isOpen={alert}\r\n          onDidDismiss={() => setAlert(false)}\r\n          header={\"Alert\"}\r\n          //ubHeader={\"Inscription avec succès\"}\r\n          message={message}\r\n          buttons={[\"OK\"]}\r\n        />\r\n        <IonGrid class=\"form\">\r\n          <IonRow class=\"ion-justify-content-center ion-align-items-center form\">\r\n            <IonCol\r\n              sizeXs=\"10\"\r\n              sizeSm=\"10\"\r\n              sizeMd=\"6\"\r\n              sizeLg=\"6\"\r\n              class=\"login-col\"\r\n            >\r\n              <IonCard>\r\n                <IonCardHeader>\r\n                  <IonText class=\"textHeader \">\r\n                    <strong>\r\n                      Connectez-vous pour un mode de vie sain. En toute\r\n                      simplicité.\r\n                    </strong>\r\n                  </IonText>\r\n                </IonCardHeader>\r\n                <IonCardContent>\r\n                  <IonList>\r\n                    <IonItem>\r\n                      <IonInput\r\n                        placeholder=\"pseudo\"\r\n                        // formControlName=\"Pseudo\"\r\n                        required\r\n                        onIonChange={(e) => setUsername(e.detail.value!)}\r\n                      ></IonInput>\r\n                    </IonItem>\r\n                    <IonItem>\r\n                      <IonInput\r\n                        type=\"password\"\r\n                        placeholder=\"Mot de passe\"\r\n                        onIonChange={(e) => setPwd(e.detail.value!)}\r\n                      ></IonInput>\r\n                    </IonItem>\r\n\r\n                    <IonRow class=\"ion-justify-content-center\">\r\n                      <IonCol class=\"text-center\" sizeMd=\"12\" sizeXs=\"12\">\r\n                        <IonButton\r\n                          class=\"btn-connec\"\r\n                          expand=\"block\"\r\n                          color=\"success\"\r\n                          onClick={() => connect()}\r\n                        >\r\n                          Connectez-vous\r\n                        </IonButton>\r\n                      </IonCol>\r\n\r\n                      <IonCol class=\"text-center\" sizeMd=\"12\" sizeXs=\"12\">\r\n                        <IonButton\r\n                          class=\"btn-inscrip\"\r\n                          expand=\"block\"\r\n                          color=\"primary\"\r\n                          fill=\"clear\"\r\n                          onClick={() => inscr()}\r\n                        >\r\n                          Inscription\r\n                        </IonButton>\r\n                      </IonCol>\r\n                    </IonRow>\r\n\r\n                    <IonRow class=\"ion-justify-content-center\">\r\n                      {\" \"}\r\n                      <br />\r\n                      <a href=\"#\">Mot de passe oublié ?</a> <br />\r\n                    </IonRow>\r\n                    <IonRow class=\"ion-justify-content-center\">\r\n                      <a href=\"#\">Contactez-nous ?</a> <br />\r\n                    </IonRow>\r\n                  </IonList>\r\n                </IonCardContent>\r\n              </IonCard>\r\n            </IonCol>\r\n          </IonRow>\r\n        </IonGrid>\r\n      </IonContent>\r\n    );\r\n  }\r\n};\r\n\r\nexport default Login;\r\n"]},"metadata":{},"sourceType":"module"}